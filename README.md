# 스마트팜 & 스마트팜 관리 서비스

## 🎙️프로젝트 소개

-    집안 어디에서나 쉽게 식물을 키울 수 있으며, 웹을 이용하여 모니터링이 가능한 가정용 농장

## 🪄 기술 스택

-    Device: PlatformIO(c++)
-    DB : MongoDB(NoSQL)

## ⏰ 개발 기간

-   2024.08.12-2024.09.06

## 사용된 장비

프로젝트에서 사용된 주요 장비 목록은 다음과 같습니다

1. **DC 팬 (DC Fan)**: 
   - 온도 조절을 위해 공기 흐름을 조절하는 용도로 사용됩니다. 펠티어 소자와 함께 사용하여 온도를 제어할 수 있습니다.
   
2. **DHT11 센서**: 
   - 온도 및 습도 측정 센서로, 실내 또는 기기 주변의 환경 데이터를 수집합니다. 안전 범위 값을 기준으로 이상 상태를 감지하는 데 사용됩니다.

3. **통양수분 측정 센서**: 
   - 토양의 수분 정도를 측정하여 식물의 상태를 모니터링합니다. 특정 수분 값 이하일 경우 펌프를 작동시켜 물을 공급하는 자동화 기능을 구현합니다.

4. **펌프 (Pump)**: 
   - **두 개의 펌프**가 사용되었습니다. 
     - 첫 번째 펌프는 토양에 물을 공급하기 위한 용도로 사용됩니다. 수분 측정 센서에서 부족 상태가 감지되면 자동으로 작동됩니다.
     - 두 번째 펌프는 비료를 공급하는 역할을 합니다. 비료가 필요한 시점에 자동으로 작동하여 식물의 성장을 도울 수 있습니다.

5. **펠티어 소자 (Peltier Element)**: 
   - 열전 효과를 이용해 냉각 및 가열을 동시에 수행할 수 있는 소자입니다. 온도 조절에 매우 유용하며, DC 팬과 함께 설치하여 열을 배출합니다.

6. **12V 조명**: 
   - 식물 생장을 돕기 위한 조명으로 사용됩니다. 자동 조명 제어 기능을 통해 일정 시간 동안만 켜지도록 설정됩니다.


### ✨ 주요 기능

## 1. AP 모드 (Access Point Mode)

AP 모드는 디바이스가 자체적으로 Wi-Fi 액세스 포인트(AP)를 설정하여 다른 장치가 해당 네트워크에 연결할 수 있도록 하는 모드입니다. 이 기능을 사용하면 사용자가 기기를 네트워크에 쉽게 등록하고 관리할 수 있습니다.

### 사용 시나리오
- **기기 초기 설정**: 사용자가 네트워크에 기기를 처음 연결할 때 AP 모드를 사용하여 쉽게 등록할 수 있습니다.
- **Wi-Fi 설정 변경**: 기기의 Wi-Fi 설정을 재설정하거나 변경할 때 유용합니다.

### 특징
- **사용자 직접 등록**: 사용자가 스마트폰이나 다른 디바이스를 통해 직접 AP에 연결하고, 필요한 정보를 입력하여 기기를 네트워크에 등록할 수 있습니다.
- **네트워크 독립성**: 기존 Wi-Fi 네트워크에 의존하지 않고, 자체 네트워크를 구성해 장치 간 연결을 관리합니다.

### 구현 방법
1. **ESP32 AP 모드 설정**: AP 모드 설정을 위해 `WiFi.softAP(ssid, password)` 함수를 사용하여 SSID와 비밀번호를 설정합니다.
2. **기기 등록 페이지 제공**: HTTP 서버를 통해 AP 모드에 연결된 기기에서 웹페이지를 열어 등록 절차를 진행할 수 있습니다.
3. **MQTT 통신 설정**: AP 모드를 통해 등록된 기기를 MQTT 브로커에 연결하여 데이터를 주고받습니다.

## 2. SPIFFS 파일 적용

SPIFFS 파일 시스템을 사용하여 사용자가 기기 등록 후 입력한 안전 범위 값을 저장하고, 이를 현재 센서로부터 수집된 데이터와 비교하여 이상 알림을 전송하는 기능을 구현하였습니다. 이 알림은 MQTT를 통해 백엔드 서버에 전달됩니다.

### 사용 시나리오
- **안전 범위 설정**: 사용자가 기기 등록 시 입력한 안전 범위 값(예: 온도, 습도, 압력 등)을 SPIFFS 파일 시스템에 저장하여, 나중에 해당 값과 센서 데이터 간의 비교를 진행합니다.
- **이상 상태 감지**: 저장된 안전 범위 값을 기준으로 현재 센서에서 읽어들인 값이 안전 범위를 벗어날 경우, 이를 감지하여 백엔드 서버에 알림을 전송합니다.

### 특징
- **데이터 영구 저장**: SPIFFS 파일 시스템을 사용하여 기기 등록 시 입력된 안전 범위 값을 디바이스에 영구적으로 저장합니다.
- **MQTT 기반 알림 시스템**: 이상 상태가 감지되면 MQTT를 통해 백엔드 서버에 경고 알림을 보냅니다.
- **실시간 비교**: 센서로부터 수집된 데이터를 주기적으로 저장된 안전 범위 값과 비교하여 실시간으로 상태를 모니터링합니다.

### 구현 방법
1. **SPIFFS 파일 시스템 초기화**: 디바이스가 시작될 때 SPIFFS 파일 시스템을 초기화하여 저장된 데이터를 불러올 준비를 합니다.
2. **안전 범위 값 저장**: 사용자가 기기 등록 시 입력한 안전 범위 값을 SPIFFS 파일에 기록합니다. 이 과정에서 파일은 JSON 형식으로 저장될 수 있습니다.
3. **센서 데이터와 비교**: 주기적으로 센서에서 데이터를 수집하고, SPIFFS에 저장된 값과 비교합니다.
4. **이상 알림 전송**: 센서 데이터가 저장된 안전 범위를 벗어날 경우, 이를 감지하여 MQTT를 통해 백엔드 서버로 알림을 전송합니다.





